{"version":3,"file":"commint.esm.js","sources":["../src/index.js"],"sourcesContent":["const DEFAULTS = {\r\n    allowed_forums: [1, 2, 3],\r\n\r\n    // Acheminement des commentaires\r\n    // - \"per_post\" : un sujet de commentaires par RP (créé si absent)\r\n    // - \"single_topic\": tous les commentaires dans un seul sujet\r\n    mode: \"per_post\",\r\n\r\n    comments_forum_id: null,\r\n\r\n    single_topic_id: null,\r\n\r\n    // UI\r\n    use_overlay: false, // false => redirection vers l’éditeur natif\r\n    button_class: \"commint-btn\",\r\n    button_append: \".post_details\",\r\n    post_class: \"post\",\r\n\r\n    // Tagging\r\n    tag_on_create: {\r\n        in_title: false, // ajouté dans le titre\r\n        format(id) {\r\n            return `#p${id}`;\r\n        },\r\n    },\r\n\r\n    // Titre du fil commentaires (mode per_topic)\r\n    comment_title_template(title, id) {\r\n        const tag = this.tag_on_create.in_title\r\n            ? ` ${this.tag_on_create.format(id)}`\r\n            : \"\";\r\n        return `${title} • Commentaires${tag}`;\r\n    },\r\n\r\n    // Message d’intro du fil nouvellement créé\r\n    new_thread_intro(rpTopic, id) {\r\n        const tagLine = `${this.tag_on_create.format(id)}\\n\\n`;\r\n        return (\r\n            `${tagLine}[b]Commentaires pour : ${rpTopic.title}[/b]\\n` +\r\n            `RP : ${rpTopic.url}\\n\\n`\r\n        );\r\n    },\r\n\r\n    // Mise en forme du message envoyé\r\n    build_payload({ permalink, op, body, quoted }) {\r\n        const header = quoted ? `[quote=\"@${op}\"]${quoted}[/quote]\\n` : \"\";\r\n        return `${header}[url=${permalink}]→ Voir le message RP[/url]\\n\\n${body}`;\r\n    },\r\n\r\n    lang: navigator.language.replace(/-.*/, \"\") || \"fr\",\r\n};\r\n\r\n/**\r\n * I18N minimal.\r\n */\r\nconst I18N = {\r\n    fr: {\r\n        comment_button: \"Commenter\",\r\n        overlay_title: \"Commenter ce message\",\r\n        cancel: \"Annuler\",\r\n        send: \"Envoyer\",\r\n        missing_post_id: \"ID du message introuvable.\",\r\n        posted_toast: \"Commentaire publié !\",\r\n    },\r\n    en: {\r\n        comment_button: \"Comment\",\r\n        overlay_title: \"Comment on this post\",\r\n        cancel: \"Cancel\",\r\n        send: \"Send\",\r\n        missing_post_id: \"Post ID not found.\",\r\n        posted_toast: \"Comment posted!\",\r\n    },\r\n    es: {\r\n        comment_button: \"Comentar\",\r\n        overlay_title: \"Comentar en este mensaje\",\r\n        cancel: \"Cancelar\",\r\n        send: \"Enviar\",\r\n        missing_post_id: \"ID del mensaje no encontrado.\",\r\n        posted_toast: \"¡Comentario publicado!\",\r\n    },\r\n};\r\n\r\nlet currentLang = \"fr\";\r\n\r\nconst T = function (label) {\r\n    return (I18N[currentLang] && I18N[currentLang][label]) || label;\r\n};\r\n\r\nT.lang = function (lang) {\r\n    currentLang = lang;\r\n    return T;\r\n};\r\n\r\nconst getEnv = async () => {\r\n    return await Moderactor.env();\r\n};\r\n\r\nclass Commint {\r\n    constructor(options) {\r\n        if (!window.Moderactor)\r\n            throw new Error(\"Commint requires Moderactor to be loaded first.\");\r\n\r\n        this.config = { ...DEFAULTS, ...options };\r\n        this.currentPosts = new Map();\r\n        this.openedPostContext = null;\r\n        this.quoted = \"\";\r\n        this.init();\r\n    }\r\n\r\n    async init() {\r\n        const t0 = performance.now();\r\n        this.env = await getEnv();\r\n\r\n        if (this.env.page.type !== \"topic\" || !this.env.user?.is_logged) return;\r\n\r\n        console.log(this.env);\r\n\r\n        if (!this.config.comments_forum_id)\r\n            throw new Error(\"An ID is required in comments_forum_id.\");\r\n\r\n        if (this.config.allowed_forums.length === 0)\r\n            throw new Error(\"At least one ID is required in allowed_forums.\");\r\n\r\n        if (this.config.mode === \"single_topic\" && !this.config.single_topic_id)\r\n            throw new Error(\r\n                'Mode \"single_topic\" requires single_topic_id to be set.'\r\n            );\r\n\r\n        // init language\r\n        if (this.config.lang) T.lang(this.config.lang);\r\n\r\n        // pre-fetch the comment topic for each post\r\n        document\r\n            .querySelectorAll(`.${this.config.post_class}`)\r\n            .forEach(async (post) => {\r\n                await this.processPost(post);\r\n            });\r\n\r\n        console.warn(Math.round(performance.now() - t0) + \"ms to init Commint\");\r\n    }\r\n\r\n    getTopic(postId) {\r\n        // doit chercher dans localStorage('comments) si un rp_id est associé à un comment_id\r\n        const comments = JSON.parse(\r\n            localStorage.getItem(\"posts_to_comments\") || \"{}\"\r\n        );\r\n        if (comments[postId]) return comments[postId];\r\n    }\r\n    /**\r\n     * Find a comments topic by its associated RP tag.\r\n     * @param {number|string} rpId - The ID of the RP.\r\n     * @returns {object|null} The comments topic or null if not found.\r\n     */\r\n    async findCommentsTopicByTag(rpId) {\r\n        const resp = await Moderactor.adapter.get(\r\n            `/tags/${this.config.tag_on_create.format(rpId).replace(/#/, \"\")}`\r\n        );\r\n        const countMatch = resp.doc.querySelector(\".postsearch_infos\");\r\n\r\n        const count = countMatch\r\n            ? Number(\r\n                  countMatch.textContent.trim().match(/Réponses:.*?(\\d+)/)[1]\r\n              )\r\n            : 0;\r\n        const a = resp.doc.querySelector(\"a.postdetails\");\r\n        if (!a) return null;\r\n        const href = a.getAttribute(\"href\");\r\n        const m = href && href.match(/\\/t(\\d+)-/);\r\n        return m\r\n            ? {\r\n                  id: Number(m[1]),\r\n                  url: href,\r\n                  title: a.textContent.trim(),\r\n                  count,\r\n              }\r\n            : null;\r\n    }\r\n\r\n    /**\r\n     * Ensure a comments topic exists for a given post ID.\r\n     * @param {number|string} id - The ID of the post.\r\n     * @returns {object|null} The comments topic or null if not found/created.\r\n     */\r\n    async ensureCommentTopic(id) {\r\n        const cache = this.getTopic(id);\r\n        if (cache && cache.time && Date.now() - cache.time <= 3600000)\r\n            return cache;\r\n\r\n        // chercher via tag\r\n        const viaTag = await this.findCommentsTopicByTag(id);\r\n        if (viaTag?.id) {\r\n            this.setTopic(id, viaTag);\r\n            return viaTag;\r\n        }\r\n\r\n        // créer si inexistant\r\n        const created = await this.createTopic({\r\n            fId: this.config.comments_forum_id,\r\n            subject: this.config.comment_title_template(\r\n                this.env.stats.topic.title,\r\n                id\r\n            ),\r\n            message: this.config.new_thread_intro(this.env.stats.topic, id),\r\n        });\r\n\r\n        if (created?.id) {\r\n            this.setTopic(id, created);\r\n            return created.id;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    setTopic(id, topic) {\r\n        const cache = JSON.parse(\r\n            localStorage.getItem(\"posts_to_comments\") || \"{}\"\r\n        );\r\n        cache[id] = { ...topic, time: Date.now() };\r\n        localStorage.setItem(\"posts_to_comments\", JSON.stringify(cache));\r\n    }\r\n\r\n    async createTopic({ fId, subject, message } = {}) {\r\n        const [res] = await Moderactor.forum(fId).post({ subject, message });\r\n        console.log(res);\r\n        const href = res?.links?.topic || \"\";\r\n        const m = href && href.match(/t=(\\d+)\\&/);\r\n        return m\r\n            ? { id: Number(m[1]), url: href, title: subject, count: 0 }\r\n            : null;\r\n    }\r\n\r\n    async processPost(post) {\r\n        const post_id =\r\n            post.getAttribute(\"id\").match(/^p?(\\d+)$/)[1] ||\r\n            post.getAttribute(\"id\");\r\n        let res = null;\r\n        if (this.config.mode === \"per_post\") {\r\n            res = await this.ensureCommentTopic(post_id);\r\n        }\r\n        if (this.config.mode === \"single_topic\") {\r\n            res = await this.ensureCommentTopic(this.config.single_topic_id);\r\n        }\r\n        if (!res) {\r\n            console.log(\"No comment topic found or created for post:\", post);\r\n            return;\r\n        }\r\n        this.addButton({ post, comment_post_id: res?.id, count: res?.count });\r\n    }\r\n\r\n    addButton({ post, comment_post_id, count }) {\r\n        // Implementation for adding a button to the post\r\n        const btn = document.createElement(\"button\");\r\n        btn.type = \"button\";\r\n        btn.className = this.config.button_class;\r\n        btn.textContent =\r\n            T(\"comment_button\") + (count > 0 ? ` (${count})` : \"\");\r\n        btn.addEventListener(\r\n            \"click\",\r\n            this.onButtonClick({ post, comment_post_id })\r\n        );\r\n        post.querySelector(this.config.button_append).appendChild(btn);\r\n    }\r\n\r\n    collectPostContext(post) {\r\n        const authorEl = post.querySelector(\r\n            \".postprofile a[href^='/u'] , .author a[href^='/u'], a[href^='/u']\"\r\n        );\r\n        const author = authorEl ? authorEl.textContent.trim() : null;\r\n        this.currentPostContext = {\r\n            author,\r\n        };\r\n    }\r\n\r\n    captureSelectedText(container) {\r\n        const sel = window.getSelection?.();\r\n        if (!sel || sel.isCollapsed) return \"\";\r\n        try {\r\n            const range = sel.getRangeAt(0);\r\n            if (!container.contains(range.commonAncestorContainer)) return \"\";\r\n            const div = document.createElement(\"div\");\r\n            div.appendChild(range.cloneContents());\r\n            this.quoted = div.textContent.trim();\r\n        } catch {\r\n            this.quoted = \"\";\r\n        }\r\n    }\r\n\r\n    onButtonClick({ post, comment_post_id }) {\r\n        return async () => {\r\n            this.collectPostContext(post);\r\n            const quoted = this.captureSelectedText(post);\r\n            if (!this.config.use_overlay) {\r\n                if (this.config.mode === \"single_topic\")\r\n                    location.href = `/post?mode=reply&t=${this.config.single_topic_id}`;\r\n                else {\r\n                    location.href = `/post?mode=reply&t=${comment_post_id}`;\r\n                }\r\n                return;\r\n            }\r\n            console.log(\"Button clicked for post:\", post, ctx, quoted);\r\n        };\r\n    }\r\n}\r\n\r\nexport default Commint;\r\n"],"names":[],"mappings":"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"}